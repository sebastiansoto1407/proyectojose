<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda Game Trivia</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="tienda.css" rel="stylesheet"> <!-- Enlace a tu archivo CSS personalizado -->
</head>
<body>
    <!-- Barra de navegación -->
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Tienda Ramiro</a>
                <div class="profile">
                    <p class="text-white mb-0"> <span id="user-name">Usuario</span></p>
                    <p class="text-white mb-0"><span id="user-points">0</span> puntos</p>
                    <p class="text-white mb-0"> <span id="user-coins">0</span> monedas</p>
                </div>
            </div>
        </nav>
        <!-- Carrito de compras -->
        <div id="cart" class="container mt-4" style="display: none;">
            <h3>Carrito de Compras</h3>
            <ul id="cart-items" class="list-group">
                <!-- Los productos del carrito se agregarán aquí -->
            </ul>
            <p id="cart-total" class="mt-3">Total: 0 monedas</p>
            <button class="btn btn-danger" onclick="clearCart()">Vaciar Carrito</button>
            <button class="btn btn-success" onclick="confirmPurchase()">Confirmar Compra</button>
            
        </div>
        
        <!-- Botón para ver el carrito -->
        <button class="btn btn-primary" onclick="toggleCart()">Ver Carrito</button>
    </header>
    <button class="btn btn-info btn-sm back-button" onclick="window.location.href='principal.html'">Volver a la página principal</button>

    <!-- Sección principal de la tienda -->
    <main class="container mt-5">
        <div class="store-section">
            <h3 class="text-center">Bienvenidos a la Tienda Game Trivia</h3>
            <p class="text-center">¡Compra productos exclusivos de Game Trivia y mejora tu experiencia de juego!</p>
            

            <!-- Productos de la tienda -->
            <div id="product-container" class="row">
                <!-- Producto 1 -->
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <img src="Captura de pantalla 2024-12-01 172013.png">
                        <div class="card-body">
                            <h5 class="card-title">Camiseta Game Trivia</h5>
                            <p class="card-text">2 monedas</p>
                            <input type="number" id="quantity-1" value="1" min="1" class="form-control mb-2">
                            <button class="btn btn-success btn-sm" onclick="addToCart('Camiseta Game Trivia', 2, document.getElementById('quantity-1').value)">Agregar al Carrito</button>
                        </div>
                    </div>
                </div>
                <!-- Producto 2 -->
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <img src="sudadera.png" class="card-img-top" alt="Sudadera Game Trivia">
                        <div class="card-body">
                            <h5 class="card-title">Sudadera Game Trivia</h5>
                            <p class="card-text">2 monedas</p>
                            <input type="number" id="quantity-2" value="1" min="1" class="form-control mb-2">
                            <button class="btn btn-success btn-sm" onclick="addToCart('Sudadera Game Trivia', 2, document.getElementById('quantity-2').value)">Agregar al Carrito</button>
                        </div>
                    </div>
                </div>
                <!-- Producto 3 -->
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <img src="gorras.png" class="card-img-top" alt="Gorra Game Trivia">
                        <div class="card-body">
                            <h5 class="card-title">Gorra Game Trivia</h5>
                            <p class="card-text">2 monedas</p>
                            <input type="number" id="quantity-3" value="1" min="1" class="form-control mb-2">
                            <button class="btn btn-success btn-sm" onclick="addToCart('Gorra Game Trivia', 2, document.getElementById('quantity-3').value)">Agregar al Carrito</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <img src="taza.png" class="card-img-top" alt="Taza Game Trivia">
                        <div class="card-body">
                            <h5 class="card-title">Taza Game Trivia</h5>
                            <p class="card-text">5 monedas</p>
                            <input type="number" id="quantity-4" value="1" min="1" class="form-control mb-2">
                            <button class="btn btn-success btn-sm" onclick="addToCart('Taza Game Trivia', 5, document.getElementById('quantity-4').value)">Agregar al Carrito</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <img src="paraguas.png" class="card-img-top" alt="Alfombrilla Game Trivia">
                        <div class="card-body">
                            <h5 class="card-title">Paraguas Game Trivia</h5>
                            <p class="card-text">4 monedas</p>
                            <input type="number" id="quantity-5" value="1" min="1" class="form-control mb-2">
                            <button class="btn btn-success btn-sm" onclick="addToCart('Alfombrilla Game Trivia', 4, document.getElementById('quantity-5').value)">Agregar al Carrito</button>
                        </div>
                    </div>
                </div>
    
                <!-- Producto 6 -->
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <img src="polos.png" class="card-img-top" alt="Llaveros Game Trivia">
                        <div class="card-body">
                            <h5 class="card-title">Polos Game Trivia</h5>
                            <p class="card-text">1 moneda</p>
                            <input type="number" id="quantity-6" value="1" min="1" class="form-control mb-2">
                            <button class="btn btn-success btn-sm" onclick="addToCart('Llaveros Game Trivia', 1, document.getElementById('quantity-6').value)">Agregar al Carrito</button>
                        </div>
                    </div>
                </div>
    
                <!-- Producto 7 -->
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <img src="bebes.png" class="card-img-top" alt="Póster Game Trivia">
                        <div class="card-body">
                            <h5 class="card-title">Ropa de bebe Game Trivia</h5>
                            <p class="card-text">2 monedas</p>
                            <input type="number" id="quantity-7" value="1" min="1" class="form-control mb-2">
                            <button class="btn btn-success btn-sm" onclick="addToCart('Póster Game Trivia', 2, document.getElementById('quantity-7').value)">Agregar al Carrito</button>
                        </div>
                    </div>
                </div>
    
                <!-- Producto 8 -->
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <img src="calzon.png" class="card-img-top" alt="Sudadera Game Trivia">
                        <div class="card-body">
                            <h5 class="card-title">Calzon Game Trivia</h5>
                            <p class="card-text">5 monedas</p>
                            <input type="number" id="quantity-8" value="1" min="1" class="form-control mb-2">
                            <button class="btn btn-success btn-sm" onclick="addToCart('Sudadera Game Trivia', 5, document.getElementById('quantity-8').value)">Agregar al Carrito</button>
                        </div>
                    </div>
                </div>
    
                <!-- Producto 9 -->
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <img src="mochila.png" class="card-img-top" alt="Mochila Game Trivia">
                        <div class="card-body">
                            <h5 class="card-title">Mochila Game Trivia</h5>
                            <p class="card-text">6 monedas</p>
                            <input type="number" id="quantity-9" value="1" min="1" class="form-control mb-2">
                            <button class="btn btn-success btn-sm" onclick="addToCart('Mochila Game Trivia', 6, document.getElementById('quantity-9').value)">Agregar al Carrito</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <div class="footer-links">
                <a href="about.html" class="footer-link">Acerca de</a>
                <a href="formulario.html" class="footer-link">Formulario</a>
                <a href="apoyo.html" class="footer-link">Apoyo</a>
                <a href="problemas.html" class="footer-link">¿Problemas?</a>
                <a href="consejos.html" class="footer-link">Consejos</a>
                <a href="contacto.html" class="footer-link">Contacto</a>
            </div>
            <div class="footer-social">
                <a href="#" class="social-icon">🔗</a>
                <a href="#" class="social-icon">📧</a>
                <a href="#" class="social-icon">🌐</a>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Función para verificar si el usuario está logueado
        if (localStorage.getItem("loggedIn") !== "true") {
            window.location.href = "index.html";
        }

        // Obtener el nombre del usuario actual
        const userName = localStorage.getItem("currentUser");

        // Obtener datos del usuario (puntos y monedas)
        const userPoints = localStorage.getItem(`${userName}-points`) || 0;
        let userCoins = parseInt(localStorage.getItem(`${userName}-coins`)) || 0;

        // Mostrar los datos en la página
        document.getElementById("user-name").textContent = userName;
        document.getElementById("user-points").textContent = userPoints;
        document.getElementById("user-coins").textContent = userCoins;

        // Función para actualizar el saldo de monedas
        function updateCoins() {
            let coins = localStorage.getItem(`${userName}-coins`);
            if (coins === null) {
                coins = 0;
                localStorage.setItem(`${userName}-coins`, coins);
            }
            document.getElementById('user-coins').textContent = coins;
        }

        // Función para mostrar u ocultar el carrito de compras
        function toggleCart() {
            const cart = document.getElementById('cart');
            cart.style.display = (cart.style.display === "none" || cart.style.display === "") ? "block" : "none";
            loadCartItems();
        }

        // Función para agregar un producto al carrito
        function addToCart(productName, price, quantity) {
            quantity = parseInt(quantity);
            let cart = JSON.parse(localStorage.getItem(`${userName}-cart`)) || [];
            const product = { name: productName, price: price, quantity: quantity };

            // Verificar si el producto ya está en el carrito
            const existingProductIndex = cart.findIndex(item => item.name === productName);
            if (existingProductIndex === -1) {
                cart.push(product); // Agregar el producto al carrito
            } else {
                // Si ya existe, sumar la cantidad
                cart[existingProductIndex].quantity += quantity;
            }
            localStorage.setItem(`${userName}-cart`, JSON.stringify(cart)); // Guardar carrito en localStorage
            alert(`¡Producto agregado al carrito!`);
            updateCartUI(); // Actualizar la interfaz del carrito
        }

        // Función para cargar los productos en el carrito en la interfaz
        function loadCartItems() {
            const cart = JSON.parse(localStorage.getItem(`${userName}-cart`)) || [];
            const cartItemsContainer = document.getElementById('cart-items');
            cartItemsContainer.innerHTML = ''; // Limpiar el carrito antes de cargar los elementos

            let total = 0;
            cart.forEach((item, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'list-group-item d-flex justify-content-between align-items-center';
                listItem.innerHTML = `${item.name} x ${item.quantity} - ${item.price * item.quantity} monedas
                    <button class="btn btn-danger btn-sm" onclick="removeFromCart(${index})">Eliminar</button>`;
                cartItemsContainer.appendChild(listItem);
                total += item.price * item.quantity;
            });

            // Mostrar el total en el carrito
            document.getElementById('cart-total').textContent = `Total: ${total} monedas`;
        }

        // Función para eliminar un producto del carrito
        function removeFromCart(index) {
            let cart = JSON.parse(localStorage.getItem(`${userName}-cart`)) || [];
            cart.splice(index, 1); // Eliminar el producto seleccionado
            localStorage.setItem(`${userName}-cart`, JSON.stringify(cart)); // Guardar el carrito actualizado
            loadCartItems(); // Actualizar la interfaz del carrito
        }

        // Función para vaciar el carrito
        function clearCart() {
            localStorage.removeItem(`${userName}-cart`); // Limpiar el carrito de localStorage
            loadCartItems(); // Actualizar la interfaz del carrito
        }

        // Función para confirmar la compra y descontar las monedas
        function confirmPurchase() {
            let cart = JSON.parse(localStorage.getItem(`${userName}-cart`)) || [];
            const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            if (userCoins >= totalPrice) {
                userCoins -= totalPrice; // Descontar las monedas
                localStorage.setItem(`${userName}-coins`, userCoins); // Guardar las monedas actualizadas
                localStorage.removeItem(`${userName}-cart`); // Vaciar el carrito
                loadCartItems(); // Actualizar la interfaz
                updateCoins(); // Actualizar el saldo de monedas en la interfaz
                alert(`¡Compra exitosa! Has pagado ${totalPrice} monedas.`);
            } else {
                alert('No tienes suficientes monedas para realizar esta compra.');
            }
        }

        // Función para volver a la tienda
        function goBackToStore() {
            toggleCart();
        }

        // Llamar a la función para actualizar las monedas cuando la página se carga
        window.onload = updateCoins;
    </script>
</body>
</html>
